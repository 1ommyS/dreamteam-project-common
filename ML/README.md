# Поиск и ранжирование
![alt text](image.png)

Система поиска и ранжирования в онлайн-кинотеатре теперь использует гибридный подход, сочетающий **текстовый поиск** с помощью **Elasticsearch**, **семантический поиск** с использованием модели **E5** для создания эмбеддингов, и **переранжирование** результатов с помощью модели **Reranker**. Это позволяет системе обеспечивать высокую точность и релевантность результатов, обрабатывая запросы как на уровне текста, так и на уровне семантики.

## Компоненты системы поиска:
1. **Elasticsearch** — отвечает за текстовый поиск по проиндексированным данным фильмов (название, жанры, описание). Возвращает список кандидатов на основе текстового соответствия с запросом.
2. **Эмбеддер (E5)** — модель, использующаяся для создания векторных представлений (эмбеддингов) для запросов и фильмов. **E5** (`intfloat/multilingual-e5-large`) используется для поиска по семантическому соответствию фильмов запросу.
3. **Milvus** — векторная база данных, которая хранит эмбеддинги фильмов и осуществляет поиск наиболее похожих фильмов на основе векторного представления запроса.
4. **Reranker (BERT)** — финальная модель для переранжирования списка кандидатов, полученных из **Elasticsearch** и **Milvus**. Модель `amberoad/bert-multilingual-passage-reranking-msmarco` оценивает релевантность каждого фильма относительно запроса пользователя.

## Процесс работы системы:
1. **Поисковый запрос** от пользователя поступает в **Elasticsearch**, который выполняет текстовый поиск и возвращает список кандидатов на основе ключевых слов (название, жанры, описание).
2. **Эмбеддер (E5)** преобразует запрос в векторное представление, после чего происходит поиск семантически близких фильмов в **Milvus**, возвращая кандидатов, релевантных на уровне смысла.
3. **Backend** объединяет уникальные результаты из **Elasticsearch** и **Milvus** в общий список кандидатов.
4. **Reranker** получает объединённый список и выполняет финальное ранжирование, оценивая релевантность каждого фильма относительно запроса с учетом контекста и семантики. Модель `amberoad/bert-multilingual-passage-reranking-msmarco` оптимизирована для многоязычных запросов.
5. **Backend** возвращает пользователю отсортированный список фильмов по итоговой релевантности.

## Преимущества подхода:
- **Гибридный поиск**: система использует как текстовую релевантность через **Elasticsearch**, так и семантическую релевантность через эмбеддинги, что позволяет получить более точные и релевантные результаты для сложных запросов.
- **Переранжирование с Reranker**: модель **BERT** на этапе переранжирования улучшает финальные результаты, учитывая контекст и глубинные связи между запросом и фильмами.
- **Многоязычная поддержка**: как модель **E5**, так и **Reranker** поддерживают многоязычные тексты, что делает систему гибкой для обработки запросов на разных языках.

## Итоговая архитектура системы поиска:
1. **Elasticsearch** для текстового поиска и извлечения кандидатов на основе ключевых слов.
2. **E5** для семантического поиска через создание эмбеддингов запросов и фильмов.
3. **Milvus** для поиска фильмов по эмбеддингам.
4. **Reranker (BERT)** для финального ранжирования списка кандидатов с учетом контекста.

Эта система обеспечивает точные и релевантные рекомендации, комбинируя как текстовые, так и семантические характеристики запроса и фильмов.

# Рекомендации

